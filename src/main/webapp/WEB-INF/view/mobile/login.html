<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Login</title>
<script type="text/javascript" th:src="@{/resources/js/flexible.js}"></script>
<link type="text/css" th:href="@{/resources/bootstrap/bootstrap-theme.min.css}" rel="stylesheet" />
<link type="text/css" th:href="@{/resources/bootstrap/bootstrap.min.css}" rel="stylesheet" />
<script type="text/javascript" th:src="@{/resources/js/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{/resources/bootstrap/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/resources/js/encryption/encryption.min.js}"></script>
<style type="text/css">
	html,body{ background-color: #333; height:100%;}
	#loginForm{ margin:0px auto; width:90%; }
	#loginBtn{ outline:medium; }
</style>
</head>
<body>
	<div style="height:3rem;"></div>
	<h1 style="color:#FFF;text-align: center;">English</h1>
	<div style="height:1rem;"></div>
	<div class="container">
		<div id="loginForm">
			<div class="input-group input-group-lg">
	            <span class="input-group-addon" style="font-size:0.4rem;">Username</span>
	            <input type="text" class="form-control" style="font-size:0.4rem;" id="uname">
	        </div>
	        <br/>
	        <div class="input-group input-group-lg">
	            <span class="input-group-addon" style="font-size:0.4rem;">Password</span>
	            <input type="password" class="form-control" style="font-size:0.4rem;" id="pwd">
	        </div>
	        <br/>
	        <button type="button" id="loginBtn" class="btn btn-primary btn-lg btn-block">Login</button>
        </div>
	</div>
	<div class="modal fade" id="alertModal" tabindex="-1">
		<!-- 窗口声明 -->
		<div class="modal-dialog">
			<!-- 内容声明 -->
			<div class="modal-content">
				<div class="modal-header">
					<button class="close" data-dismiss="modal">
						<span>&times;</span>
					</button>
					<h4 class="modal-title">警告</h4>
				</div>
				<div class="modal-body">
					<p id="alertMessage"></p>
				</div>
			</div>
		</div>
	</div>
<script type="text/javascript" th:inline="javascript">

function doLogin(){
	var uname = $("#uname").val();
    var pwd = $("#pwd").val();
    if(uname == "" || pwd == "" || uname == undefined || pwd == undefined){
        return;
	}else{
		//使用MD5加密
        var md5word = hex_md5(pwd);
        //再用哈希加密
        var hash2word = hex_sha1(md5word);
        //再用AES加密
        var encodeStr = Encrypt(hash2word);
        
        login(uname,encodeStr);
	}
}

function login(uname,pwd){
    $.post("/login/commit.do",{
		username : uname,
		password : pwd,
	},function(data){
		if(data.STATUS == "SUCCESS"){
           	window.location.href= "/index.do";
       	}else{
       		$("#alertMessage").html(data.MESSAGE);
       		$('#alertModal').modal('show');
       	}
   },"JSON");
}

$("#loginBtn").click(doLogin);

$('#pwd').keydown(function(e){
	if(e.keyCode==13){
		doLogin();
	}
});



</script>
</body>
</html>